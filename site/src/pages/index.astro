---
import '@/styles/global.css';
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Navbar from '@/components/Navbar.astro';
import HeroBitcoin from '@/components/HeroBitcoin.astro';
import ToolsShowcase from '@/components/ToolsShowcase.astro';
import BranchExplorer from '@/components/BranchExplorer.astro';
import FeaturedGuides from '@/components/FeaturedGuides.astro';
import NewsletterCTA from '@/components/NewsletterCTA.astro';
import Footer from '@/components/Footer.astro';

const allPages = await getCollection('bitcoin');
const branches = allPages
  .filter(p => p.id !== 'index' && p.data.parent === null && p.data.type === 'hub')
  .sort((a, b) => a.data.order - b.data.order);
const allGuides = allPages.filter(p => p.data.type === 'guide');

const featuredSlugs = [
  'investir-bitcoin/strategie-dca-bitcoin',
  'acheter-bitcoin/coinbase',
  'securite-bitcoin/guide-seed-phrase',
  'meilleurs-portefeuilles-bitcoin/ledger-nano-x',
  'histoire-bitcoin/halvings-bitcoin',
  'reglementation-bitcoin/fiscalite-bitcoin-france',
];
const featuredGuides = featuredSlugs
  .map(slug => allPages.find(p => p.id === slug))
  .filter(Boolean) as typeof allPages;

const seoTitle = 'CryptoSous - Le guide Bitcoin complet en francais';
const seoDescription = `${allGuides.length}+ guides pratiques en ${branches.length} themes pour comprendre, acheter et investir dans Bitcoin. Outils gratuits, sans pub, 100% independant.`;
---

<BaseLayout title={seoTitle} description={seoDescription}>
  <Navbar />
  <main>
    <HeroBitcoin totalGuides={allGuides.length} totalBranches={branches.length} />
    <ToolsShowcase />
    <BranchExplorer branches={branches} allPages={allPages} />
    <FeaturedGuides guides={featuredGuides} />
    <NewsletterCTA />
  </main>
  <Footer />
</BaseLayout>
